13周必做题

（必做）按自己设计的表结构，插入100万订单模拟数据，测试不同方式的插入效率。

1、使用java代码提交

​	1>使用statement进行提交，每次插入的条数和整体执行时间表格如下：

| 每次提交执行条数                                    | 单词执行时间 | 总执行时间         |
| --------------------------------------------------- | ------------ | ------------------ |
| 1                                                   | 26ms左右     | 没测，估计在6h左右 |
| 10                                                  | 26ms左右     | 估计40min左右      |
| 100                                                 | 30ms左右     | 319s               |
| 1000                                                | 70ms左右     | 70s左右            |
| 5000（10000条数据量太大超出限制，所以测试一下5000） | 575ms左右    | 135s               |
| 10000（数据量太大超过2^1024不能提交）               |              |                    |

总结，insert条数在数据量少的时候执行时间差不多，数据量逐渐倍数增大，执行时间并没有成倍数增长，所以整体执行时间会缩短很多，等到单词insert的条数太多时，又会造成单词执行时间过长，整体执行时间减慢。所以对于insert不要一次性执行太多条数，也不要一条一条慢慢执行。

2> 使用PreparedStatement进行批处理，简单测试了一下，每10条做一个批次提交大概需要300ms左右，100条大概需要2600多ms，到1000条大概是26000ms,性能比较差。

2、使用存储过程

```sql
create PROCEDURE insert_batch()
BEGIN
	DECLARE n int DEFAULT 1;
		loopname: LOOP
			INSERT INTO `test`.`goods_order`(`order_name`, `u_id`, `u_name`, `trade_amount`, `trade_type`, `order_status`, `u_phone`, `trade_num`, `source`, `goods_id`, `goods_name`, `coupon_id`, `c_time`, `u_time`, `remark`, `is_hidden`) VALUES ('1', 11, 'test', '111', 1, 2, '1883823823', 12, 'h5', 1, 'asdadsad', 1, '2020-11-29 19:02:07', '2020-11-29 19:02:07', '1', 1);
			SET n = n+1;
		IF n = 1000000 then 
			leave loopname;
		END IF;
		END LOOP loopname;
END;
```

使用存储过程，执行504秒增加19000条，平均每条执行26ms，跟用jdbc的时间差不多。提高存储过程执行的效率还是得一次插入多条。

3、使用连接池执行，单个新增，平均每条执行20多ms。

总结：执行效率和每次执行的条数有关，跟存储过程、或者使用连接池没有关系，使用批处理效果可能还不如每次新增多条记录；新增多条的时候也不能同事新增太多，会造成性能的下降。